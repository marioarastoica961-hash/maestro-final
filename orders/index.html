<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>My Orders – Maestro Market</title>
  <style>
    body {font-family: system-ui, sans-serif; margin:0; background:#f7f7f8; color:#111;}
    header {padding:16px 20px; background:#059669; color:#fff; font-weight:bold;}
    main {max-width:960px; margin:24px auto; padding:0 16px;}
    .card {background:#fff; border:1px solid #eee; border-radius:14px; padding:20px; margin-bottom:16px;}
    label {font-weight:600; display:block; margin-bottom:6px;}
    input[type="email"] {width:100%; padding:10px; border:1px solid #ccc; border-radius:8px; font-size:1rem;}
    button {margin-top:10px; padding:12px 18px; background:#10b981; color:#fff; border:none; border-radius:10px; font-weight:600; cursor:pointer;}
    button:hover {background:#059669;}
    table {width:100%; border-collapse:collapse; margin-top:20px;}
    th, td {padding:12px; border-bottom:1px solid #eee; text-align:left;}
    th {background:#f1f5f9;}
    .empty {color:#666; margin-top:20px;}
  </style>
</head>
<body>
  <header>Maestro Market · My Orders</header>

  <main>
    <h1>Check your orders</h1>
    <section class="card">
      <label for="email">Email</label>
      <input type="email" id="email" placeholder="you@email.com" required/>
      <button id="check-btn">Show my orders</button>
    </section>

    <section id="orders-section" class="card" style="display:none;">
      <h2>Results</h2>
      <div id="orders-output"></div>
    </section>
  </main>

  <script>
  // Pre-fill email if provided via querystring
  (function() {
    const p = new URLSearchParams(location.search);
    const e = p.get("email");
    if (e) document.getElementById("email").value = e;
  })();

  document.getElementById("check-btn").addEventListener("click", async () => {
    const email = document.getElementById("email").value.trim();
    if (!email) { alert("Please enter your email."); return; }

    const output = document.getElementById("orders-output");
    const section = document.getElementById("orders-section");
    section.style.display = "block";
    output.innerHTML = "⏳ Loading...";

    try {
      const res = await fetch("https://pay.hazelsophia.tech/orders?email=" + encodeURIComponent(email), { cache: "no-store" });
      if (!res.ok) throw new Error("HTTP " + res.status);
      const data = await res.json();

      if (!data || !data.length) {
        output.innerHTML = '<p class="empty">No orders found for this email.</p>';
        return;
      }

      let html = "<table><thead><tr><th>ID</th><th>Agent</th><th>Delivery</th><th>Total</th><th>Status</th></tr></thead><tbody>";
      data.forEach(order => {
        html += `<tr>
          <td>${order.orderId}</td>
          <td>${order.agentName || order.slug}</td>
          <td>${order.delivery}</td>
          <td>$${order.amount}</td>
          <td>${order.status}</td>
        </tr>`;
      });
      html += "</tbody></table>";
      output.innerHTML = html;
    } catch (err) {
      console.error("orders error:", err);
      output.innerHTML = "<p class='empty'>Error while fetching your orders. Please try again later.</p>";
    }
  });
  </script>
</body>
</html>
