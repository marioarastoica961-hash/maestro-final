<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>AI Agents Catalog — Maestro Market</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body{margin:0;background:#f7f7f7;font-family:Arial,Helvetica,sans-serif}
    header{background:#0b8a56;color:#fff;padding:18px 20px;position:sticky;top:0;z-index:100}
    header .bar{max-width:1200px;margin:0 auto;display:flex;align-items:center;justify-content:space-between}
    header nav a{color:#fff;text-decoration:none;margin-left:16px;font-weight:700}
    .wrap{max-width:1200px;margin:0 auto;padding:28px 20px}
    .controls{display:flex;gap:10px;flex-wrap:wrap;margin:10px 0 18px}
    input,select{padding:10px 12px;border:1px solid #ddd;border-radius:10px}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
    .card{background:#fff;border-radius:14px;box-shadow:0 10px 24px rgba(0,0,0,.06);padding:18px;display:flex;flex-direction:column;justify-content:space-between}
    .price{font-weight:900;color:#0b6e48}
    .row{display:flex;gap:10px;margin-top:10px}
    .btn{display:inline-block;padding:10px 14px;border-radius:12px;text-decoration:none;font-weight:800}
    .btn-primary{background:#18a362;color:#fff}
    .btn-ghost{background:#083f2c;color:#fff}
    .pagination{display:flex;gap:8px;justify-content:center;margin:22px 0}
    .pagination button{padding:8px 12px;border:1px solid #ddd;background:#fff;border-radius:8px;cursor:pointer}
    @media(max-width:1024px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media(max-width:680px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
<header>
  <div class="bar">
    <strong style="font-size:18px">Maestro Market</strong>
    <nav>
      <a href="/">Home</a>
      <a href="/agents/">AI Agents</a>
      <a href="/leads/">Leads</a>
      <a href="/cart/">Cart <span id="cart-badge"></span></a>
      <a href="/account/">My Account</a>
    </nav>
  </div>
</header>

<main class="wrap">
  <h1 style="margin:0 0 8px">AI Agents</h1>
  <div class="controls">
    <input id="q" type="search" placeholder="Search agents…" style="min-width:260px" />
    <select id="cat"></select>
    <select id="integr"></select>
    <select id="pricing">
      <option value="">All pricing</option>
      <option value="one">One-time</option>
      <option value="sub">Subscription</option>
    </select>
  </div>

  <div id="count" style="opacity:.7;margin-bottom:6px"></div>
  <section id="grid" class="grid" aria-live="polite"></section>
  <div id="pager" class="pagination"></div>
</main>

<footer style="background:#0b8a56;color:#fff;text-align:center;padding:20px">© 2025 Maestro Market</footer>

<script src="/js/agents-data.js" defer></script>

<!-- Catálogo + Carrito (ESM) -->
<script type="module">
  import { addToCart, fmtPrice, updateCartBadge } from '/js/cart.js';

  // ===== Agents-list (adaptado para Buy) =====
  const data = window.MAESTRO_AGENTS || [];
  const meta = window.MAESTRO_META || { categories: [], integrations: [] };

  const q = document.getElementById('q');
  const cat = document.getElementById('cat');
  const integr = document.getElementById('integr');
  const pricing = document.getElementById('pricing');
  const grid = document.getElementById('grid');
  const count = document.getElementById('count');
  const pager = document.getElementById('pager');

  cat.innerHTML = `<option value="">All categories</option>` + meta.categories.map(c => `<option>${c}</option>`).join('');
  integr.innerHTML = `<option value="">All integrations</option>` + meta.integrations.map(i => `<option>${i}</option>`).join('');

  let page = 1, pageSize = 12;

  function filter() {
    const query = (q.value || '').toLowerCase();
    const fc = cat.value || '';
    const fi = integr.value || '';
    const fp = pricing.value || '';

    return data.filter(a => {
      if (fc && a.category !== fc) return false;
      if (fi && !a.integrations.includes(fi)) return false;
      if (fp === 'one' && a.pricing.model !== 'one-time') return false;
      if (fp === 'sub' && a.pricing.model !== 'subscription') return false;
      if (query && !(a.name.toLowerCase().includes(query) || a.shortDesc.toLowerCase().includes(query))) return false;
      return true;
    });
  }

  function render() {
    const items = filter();
    count.textContent = `${items.length} agents found`;
    const pages = Math.max(1, Math.ceil(items.length / pageSize));
    if (page > pages) page = pages;
    const start = (page-1)*pageSize;
    const slice = items.slice(start, start+pageSize);

    grid.innerHTML = slice.map(a => {
      const priceText = fmtPrice(a.pricing.model, a.pricing.amount);
      return `
        <article class="card">
          <div>
            <h3 style="margin:0 0 4px">${a.name}</h3>
            <div style="opacity:.7;margin-bottom:8px">${a.category}</div>
            <p style="margin:0 0 10px">${a.shortDesc}</p>
            <div style="opacity:.8;font-size:14px">Integrations: ${a.integrations.join(', ')}</div>
          </div>
          <div class="row">
            <a class="btn btn-ghost" href="/agents/detail.html?slug=${encodeURIComponent(a.slug)}">Details</a>
            <button class="btn btn-primary add" data-slug="${a.slug}">Buy</button>
            <span class="price">${priceText}</span>
          </div>
        </article>
      `;
    }).join('');

    // attach buy events
    grid.querySelectorAll('.add').forEach(btn => {
      btn.addEventListener('click', () => {
        const slug = btn.dataset.slug;
        const a = data.find(x => x.slug === slug);
        addToCart({
          slug: a.slug,
          name: a.name,
          model: a.pricing.model,
          amount: a.pricing.amount,
          qty: 1
        });
        btn.textContent = 'Added ✓';
        updateCartBadge();
        setTimeout(()=>btn.textContent='Buy',900);
      });
    });

    // Pager
    pager.innerHTML = '';
    for (let i=1;i<=pages;i++){
      const b = document.createElement('button');
      b.textContent = i;
      if (i===page){ b.style.background='#0b8a56'; b.style.color='#fff'; }
      b.addEventListener('click', ()=>{ page=i; render(); });
      pager.appendChild(b);
    }
  }

  [q,cat,integr,pricing].forEach(el => el.addEventListener('input', ()=>{page=1;render();}));
  render();
</script>
</body>
</html>
